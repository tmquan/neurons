# SNEMI3D Configuration
# Volumetric neuron segmentation (3D patches)

defaults:
  - default

experiment_name: snemi3d_instance_seg
project_name: neurons-snemi3d

data:
  dataset: snemi3d
  data_root: data/snemi3d
  batch_size: 4
  num_workers: 32
  train_val_split: 0.2
  cache_rate: 0.5
  slice_mode: false
  num_samples: 400  # random 3D crops per epoch (volume has 100 Z-slices)
  patch_size:
    - 32
    - 128
    - 128

model:
  type: vista3d
  in_channels: 1
  num_classes: 16
  emb_dim: 16
  feature_size: 64

optimizer:
  type: adamw
  lr: 1.0e-4
  weight_decay: 1.0e-5
  scheduler:
    type: cosine
    T_max: 100
    eta_min: 1.0e-6

loss:
  semantic_mode: sigmoid     # sigmoid (multi-label: mito inside neuron) or softmax (mutually exclusive)
  weight_semantic: 1.0
  weight_ce: 1.0
  weight_iou: 1.0
  weight_dice: 1.0
  weight_instance: 1.0
  weight_pull: 1.0
  weight_push: 1.0
  weight_norm: 0.001
  delta_v: 0.5
  delta_d: 1.5
  weight_edge: 10.0
  weight_bone: 10.0
  weight_geometry: 1.0
  dir_target: skeleton         # skeleton (geometry-aware) or centroid
  weight_dir: 1.0
  weight_cov: 1.0
  weight_raw: 1.0
  loss_dir: smooth_l1          # smooth_l1 (robust offsets), mse, or l1
  loss_cov: mse                # mse (Frobenius-norm), l1, or smooth_l1
  loss_raw: l1                 # l1 (sharp reconstruction), mse, or smooth_l1
  ignore_index: -100

training:
  max_epochs: 200
  accelerator: auto
  devices: 4
  precision: 16-mixed
  gradient_clip_val: 1.0
