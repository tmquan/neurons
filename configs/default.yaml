# Neurons Default Configuration
# Base configuration for all connectomics training tasks

# Experiment metadata
experiment_name: neurons
project_name: neurons
seed: 42

# Logging configuration
logger: tensorboard  # Options: tensorboard, wandb
log_dir: logs

# Data configuration
data:
  dataset: snemi3d  # Options: snemi3d, cremi3d, microns, combine
  data_root: data
  batch_size: 4
  num_workers: 4
  train_val_split: 0.2
  cache_rate: 0.5
  pin_memory: true
  image_size: null  # Optional resize, e.g., [256, 256]
  slice_mode: true  # Return 2D slices
  num_samples: null  # Samples per epoch (null = auto from volume size)

# Model configuration
model:
  type: vista3d  # Options: vista3d, vista2d
  in_channels: 1
  num_classes: 16
  emb_dim: 16
  feature_size: 64

# Optimizer configuration
optimizer:
  type: adamw
  lr: 1.0e-3
  weight_decay: 1.0e-4
  scheduler:
    type: cosine
    T_max: 100
    eta_min: 1.0e-6

# Loss configuration
loss:
  semantic_mode: sigmoid     # sigmoid (multi-label: mito inside neuron) or softmax (mutually exclusive)
  weight_semantic: 1.0
  weight_ce: 1.0
  weight_iou: 1.0
  weight_dice: 1.0
  weight_instance: 1.0
  weight_pull: 1.0
  weight_push: 1.0
  weight_norm: 0.001
  delta_v: 0.5
  delta_d: 1.5
  weight_edge: 10.0
  weight_bone: 10.0
  weight_geometry: 0.0
  dir_target: skeleton         # centroid or skeleton
  weight_dir: 1.0
  weight_cov: 1.0
  weight_raw: 1.0
  loss_dir: smooth_l1          # smooth_l1 (robust offsets), mse, or l1
  loss_cov: mse                # mse (Frobenius-norm), l1, or smooth_l1
  loss_raw: l1                 # l1 (sharp reconstruction), mse, or smooth_l1
  ignore_index: -100

# Training configuration
training:
  training_modes:
    - automatic
    - proofread
  num_pos_points: 5
  num_neg_points: 5
  point_sample_mode: "instance"  # Options: class, instance
  max_epochs: 100
  accelerator: auto  # Options: cpu, gpu, tpu, auto
  devices: 4
  strategy: auto
  precision: 32-true  # Options: 32-true, 16-mixed, bf16-mixed
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  val_check_interval: 1.0
  check_val_every_n_epoch: 1
  num_sanity_val_steps: 2
  log_every_n_steps: 50
  enable_progress_bar: true
  enable_model_summary: true
  deterministic: false
  benchmark: true
  fast_dev_run: false

# Callbacks configuration
callbacks:
  checkpoint:
    enabled: true
    dirpath: null
    filename: "{epoch:02d}-{val/loss:.4f}"
    save_top_k: 3
    monitor: val/loss
    mode: min
    save_last: true
    verbose: true

  early_stopping:
    enabled: false
    monitor: val/loss
    patience: 20
    mode: min
    verbose: true
    min_delta: 0.0

  lr_monitor:
    enabled: true

  image_logger:
    enabled: true
    every_n_epochs: 1
    max_images: 4
